services:

  nginx:
    restart: always
    build:
      context: ./
      dockerfile: ./docker/Dockerfile_nginx_local
    volumes:
      - ./docker/logs/nginx:/var/log/nginx
      - ./app:/var/www/html
    ports:
      - ${NGINX_PORT}:80
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - NGINX_ENTRYPOINT_QUIET_LOGS=1
      - TZ=Europe/Moscow
    depends_on:
      - php

  php:
    restart: always
    build:
      context: ./
      dockerfile: ./docker/Dockerfile_php_local
      args:
        INSTALL_XDEBUG: '${INSTALL_XDEBUG}'
    user: '${UID}:${GID}'
    volumes:
      - ./app:/var/www/html
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - APP_ENV=local
      - APP_DEBUG=true
      - TZ=Europe/Moscow
    env_file:
      - ./.env

  node:
    restart: always
    build:
      context: ./
      dockerfile: ./docker/Dockerfile_node_local
    user: '${UID}:${GID}'
    volumes:
      - ./app:/var/www/html
    ports:
      - "5173:5173"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - NODE_ENV=development
      - TZ=Europe/Moscow
    env_file:
      - ./.env
